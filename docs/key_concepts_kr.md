# 📚 핵심 개념

이 가이드는 주요 용어와 개념을 자세히 설명합니다.

## 노드 명세

노드 명세는 각 노드의 작동 방식과 포트 연결을 선언적으로 정의합니다. 이 명세는 엔진에 의해 실행 가능한 노드로 컴파일됩니다.

```yaml
id: 01908c74-8b22-7cbf-a475-6b6bc871b01a
kind: snippet
namespace: default
name: foo
annotations:
  key1: value1
  key2: value2
language: text
code: foo
ports:
  out:
    - name: bar
      port: in
    - id: 01908c74-8b22-7cc0-ae2b-40504e7c9ff0
      port: in
```

- `id`: UUID 형식으로, UUID V7을 권장합니다.
- `kind`: 노드의 종류를 지정하며, 종류에 따라 명세가 달라질 수 있습니다.
- `namespace`: 노드가 속하는 네임스페이스를 지정하며, 기본값은 `default`입니다.
- `name`: 노드의 이름을 지정하며, 동일한 네임스페이스 내에서 고유해야 합니다.
- `annotations`: 노드 명세에 추가적인 메타데이터를 포함할 수 있습니다. 이 값은 엔진에 의해 사용되지 않지만, 확장 기능 제공이나 외부 서비스와의 통합에 유용합니다. 키와 값은 문자열 형태입니다.
- `language`, `code`: `snippet` 종류의 노드에서 필요한 추가 필드입니다. 노드 종류에 따라 필요한 필드가 달라질 수 있습니다.
- `ports`: 포트가 어떻게 연결되는지를 정의합니다. 각 포트는 다른 노드의 ID나 이름 및 포트 이름으로 식별됩니다.

## 노드

노드는 데이터 처리 객체로, 서로 연결된 포트를 통해 패킷을 주고받으며 워크플로우를 실행합니다. 노드는 독립적인 처리 루프를 가지고 있어 다른 노드와 비동기적으로 통신합니다.

노드는 패킷 처리 방식에 따라 다섯 가지로 분류됩니다:
- `ZeroToOne`: 최초로 패킷을 생성하여 워크플로우를 시작하는 노드입니다.
- `OneToOne`: 하나의 입력 포트에서 패킷을 받아 처리하고 하나의 출력 포트로 전송하는 노드입니다.
- `OneToMany`: 하나의 입력 포트에서 패킷을 받아 처리하고 여러 개의 출력 포트로 전송하는 노드입니다.
- `ManyToOne`: 여러 입력 포트에서 패킷을 받아 모아 처리하고 하나의 출력 포트로 전송하는 노드입니다.
- `Other`: 단순한 패킷 전달 이외에도 상태 관리와 상호작용을 포함하는 노드입니다.

## 포트

포트는 각 노드가 패킷을 주고받는 연결 지점입니다. `InPort`와 `OutPort` 두 종류의 포트가 있으며, 이들을 연결하여 패킷을 전송합니다. 한 포트로 전송된 패킷은 모든 연결된 포트로 전달됩니다.

일반적으로 사용되는 포트 이름은 다음과 같습니다:
- `io`: 패킷을 처리하고 즉시 반환합니다.
- `in`: 패킷을 입력받아 처리하고, 처리 결과를 `out`이나 `error`로 전송합니다. 연결된 `out`이나 `error` 포트가 없을 경우 결과를 반환합니다.
- `out`: 처리된 패킷을 전송합니다. 전송된 결과는 `in`으로 다시 전송될 수 있습니다.
- `error`: 패킷 처리 중 발생한 오류를 전송합니다. 오류 처리 결과는 `in`으로 다시 전송될 수 있습니다.

동일한 역할을 하는 여러 개의 포트가 필요할 때는 `in[0]`이나 `out[1]`과 같이 표현합니다.

## 패킷

패킷은 포트 간에 교환되는 데이터를 말하며, 각 패킷은 페이로드를 포함합니다.

노드는 요청 패킷의 전송 순서에 따라 해당하는 응답 패킷을 반환해야 합니다. 여러 포트에 연결된 경우, 모든 응답 패킷을 모아 하나의 새로운 응답 패킷으로 노드에 반환됩니다.

또한, 패킷이 단순히 수락되었음을 나타내는 특수한 `None` 패킷이 존재하여 응답이 없음을 나타냅니다.

패킷은 노드 간 연결을 따라 전송되어 처리됩니다. 처음 패킷이 연결된 포트를 따라 전파되는 것을 순전파라고 하며, 모든 처리가 완료된 후 패킷이 처리 방향을 거슬러 올라가면서 응답이 반환되는 것을 역전파라고 합니다.

## 프로세스

프로세스는 실행의 기본 단위로, 서로 독립적으로 관리됩니다. 프로세스는 부모 프로세스를 가질 수 있으며, 부모 프로세스가 종료되면 자식 프로세스도 함께 종료됩니다.

프로세스는 패킷으로 전송하기 어려운 값을 저장하기 위해 각자의 저장소를 가지고 있으며, Copy-On-Write (COW) 방식으로 동작하여 부모 프로세스의 데이터를 효율적으로 공유합니다.

새로운 워크플로우를 시작하기 위해 프로세스를 생성하며, 프로세스가 종료되면 사용된 모든 자원이 해제됩니다.

프로세스는 두 개 이상의 루트 패킷을 가질 수 있지만, 루트 패킷은 같은 노드에서 생성되어야 하며, 다른 노드에서 생성될 경우 새로운 자식 프로세스를 생성하여 흐름을 처리해야 합니다.

## 워크플로우

워크플로우는 방향성을 가진 그래프로 정의되며, 여러 노드들이 연결된 구조입니다. 이 그래프에서 각 노드는 데이터 처리를 담당하며, 패킷은 노드들 사이를 통해 전송됩니다.

워크플로우는 일련의 단계로 구성되며, 각 단계에서 데이터는 정의된 규칙에 따라 처리되고 전달됩니다. 이 과정에서 데이터는 순차적으로 또는 병렬적으로 처리될 수 있습니다.

예를 들어, 초기 데이터가 주어지면 첫 번째 노드에서 처리된 후 다음 노드로 전달됩니다. 각 노드는 입력을 받아 처리하고, 처리된 결과를 다음 단계로 전송합니다.

## 네임스페이스

네임스페이스는 워크플로우를 격리하여 관리하며, 독립된 실행 환경을 제공합니다. 각 네임스페이스는 여러 워크플로우를 포함할 수 있으며, 네임스페이스 내의 노드는 다른 네임스페이스에 속한 노드를 참조할 수 없습니다. 각 네임스페이스는 자체 데이터 및 리소스를 독립적으로 관리합니다.

## 런타임 환경

런타임 환경은 각 네임스페이스가 실행되는 독립적인 공간입니다. 엔진은 네임스페이스에 속한 모든 노드를 로드하여 환경을 구축하고 워크플로우를 실행합니다. 이를 통해 워크플로우 실행 중 발생할 수 있는 충돌을 방지하고, 안정적인 실행 환경을 제공합니다.
