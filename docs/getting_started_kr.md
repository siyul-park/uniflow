# π€ μ‹μ‘ν•κΈ°

μ΄ μ•λ‚΄μ„λ” [λ…λ Ήμ¤„ μΈν„°νμ΄μ¤(CLI)](../cmd/README_kr.md)λ¥Ό μ„¤μΉν•κ³  κµ¬μ„±ν•λ©° μ›ν¬ν”λ΅μ°λ¥Ό κ΄€λ¦¬ν•λ” λ°©λ²•μ„ μμ„Έν μ„¤λ…ν•©λ‹λ‹¤. μ„¤μΉμ—μ„λ¶€ν„° μ›ν¬ν”λ΅μ° μ μ–΄ λ° μ„¤μ •κΉμ§€μ μ „λ°μ μΈ κ³Όμ •μ„ λ‹¤λ£Ήλ‹λ‹¤.

## μ†μ¤μ—μ„ μ„¤μΉν•κΈ°

λ¨Όμ € [λ‚΄μ¥λ ν™•μ¥ κΈ°λ¥](../ext/README_kr.md)κ³Ό ν•¨κ» μ κ³µλλ” [CLI](../cmd/README_kr.md)λ¥Ό μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤. μ„¤μΉλ¥Ό μ‹μ‘ν•κΈ° μ „μ— μ‹μ¤ν…μ— [Go 1.22](https://go.dev/doc/install) μ΄μƒμ΄ μ„¤μΉλμ–΄ μλ”μ§€ ν™•μΈν•μ„Έμ”.

### λ¦¬ν¬μ§€ν† λ¦¬ ν΄λ΅ 

μ†μ¤ μ½”λ“λ¥Ό ν΄λ΅ ν•λ ¤λ©΄ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤:

```sh
git clone https://github.com/siyul-park/uniflow
```

ν΄λ΅ ν• λ””λ ‰ν† λ¦¬λ΅ μ΄λ™ν•©λ‹λ‹¤:

```sh
cd uniflow
```

### μμ΅΄μ„± μ„¤μΉ λ° λΉλ“

μμ΅΄μ„±μ„ μ„¤μΉν•κ³  ν”„λ΅μ νΈλ¥Ό λΉλ“ν•λ ¤λ©΄ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤:

```sh
make init
make build
```

λΉλ“κ°€ μ™„λ£λλ©΄ `dist` ν΄λ”μ— μ‹¤ν–‰ νμΌμ΄ μƒμ„±λ©λ‹λ‹¤.

### μ„¤μ •

`.uniflow.toml` νμΌμ΄λ‚ μ‹μ¤ν… ν™κ²½ λ³€μλ¥Ό ν†µν•΄ μ„¤μ •μ„ μ μ—°ν•κ² λ³€κ²½ν•  μ μμµλ‹λ‹¤. μ£Όμ” κµ¬μ„± μµμ…μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

| TOML ν‚¤              | ν™κ²½ λ³€μ ν‚¤            | μμ‹                       |
|----------------------|-------------------------|----------------------------|
| `database.url`       | `DATABASE.URL`          | `mem://` λλ” `mongodb://` |
| `database.name`      | `DATABASE.NAME`         | -                          |
| `collection.nodes`   | `COLLECTION.NODES`      | `nodes`                    |
| `collection.secrets` | `COLLECTION.SECRETS`    | `secrets`                  |

[MongoDB](https://www.mongodb.com/)λ¥Ό μ‚¬μ©ν•λ” κ²½μ°, μ—”μ§„μ΄ λ…Έλ“ λ…μ„Έ λ° μ‹ν¬λ¦Ώ λ³€κ²½μ„ μ¶”μ ν•  μ μλ„λ΅ [λ³€κ²½ μ¤νΈλ¦Ό](https://www.mongodb.com/docs/manual/changeStreams/)μ„ ν™μ„±ν™”ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ [λ³µμ  μ„ΈνΈ](https://www.mongodb.com/docs/manual/replication/) μ„¤μ •μ΄ ν•„μ”ν•©λ‹λ‹¤.

## Uniflow

`uniflow`λ” μ£Όλ΅ λ°νƒ€μ„ ν™κ²½μ„ μ‹μ‘ν•κ³  κ΄€λ¦¬ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

### Start

`start` λ…λ Ήμ–΄λ” νΉμ • λ„¤μ„μ¤νμ΄μ¤μ λ…Έλ“ λ…μ„Έλ΅ λ°νƒ€μ„μ„ μ‹μ‘ν•©λ‹λ‹¤. κΈ°λ³Έ μ‚¬μ©λ²•μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

```sh
./dist/uniflow start --namespace default
```

λ„¤μ„μ¤νμ΄μ¤κ°€ λΉ„μ–΄ μλ” κ²½μ°, `--from-nodes` ν”λκ·Έλ¥Ό μ‚¬μ©ν•μ—¬ μ΄κΈ° λ…Έλ“ λ…μ„Έλ¥Ό μ κ³µν•  μ μμµλ‹λ‹¤:

```sh
./dist/uniflow start --namespace default --from-nodes examples/nodes.yaml
```

μ΄κΈ° μ‹ν¬λ¦Ώμ„ μ κ³µν•λ ¤λ©΄ `--from-secrets` ν”λκ·Έλ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤:

```sh
./dist/uniflow start --namespace default --from-secrets examples/secrets.yaml
```

μ΄ λ…λ Ήμ–΄λ” μ§€μ •λ λ„¤μ„μ¤νμ΄μ¤μ λ¨λ“  λ…Έλ“ λ…μ„Έλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤. λ„¤μ„μ¤νμ΄μ¤λ¥Ό μ§€μ •ν•μ§€ μ•μΌλ©΄ `default` λ„¤μ„μ¤νμ΄μ¤κ°€ μ‚¬μ©λ©λ‹λ‹¤.

## Uniflowctl

`uniflowctl`λ” λ„¤μ„μ¤νμ΄μ¤ λ‚΄μ—μ„ λ…Έλ“ λ…μ„Έμ™€ μ‹ν¬λ¦Ώμ„ κ΄€λ¦¬ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

### Apply

`apply` λ…λ Ήμ–΄λ” λ„¤μ„μ¤νμ΄μ¤μ— λ…Έλ“ λ…μ„Έ λλ” μ‹ν¬λ¦Ώμ„ μ¶”κ°€ν•κ±°λ‚ μ—…λ°μ΄νΈν•©λ‹λ‹¤. μ‚¬μ© μμ‹λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

```sh
./dist/uniflowctl apply nodes --namespace default --filename examples/nodes.yaml
```

λλ”

```sh
./dist/uniflowctl apply secrets --namespace default --filename examples/secrets.yaml
```

μ΄ λ…λ Ήμ–΄λ” μ§€μ •λ νμΌμ λ‚΄μ©μ„ λ„¤μ„μ¤νμ΄μ¤μ— μ μ©ν•©λ‹λ‹¤. λ„¤μ„μ¤νμ΄μ¤λ¥Ό μ§€μ •ν•μ§€ μ•μΌλ©΄ κΈ°λ³Έμ μΌλ΅ `default` λ„¤μ„μ¤νμ΄μ¤κ°€ μ‚¬μ©λ©λ‹λ‹¤.

### Delete

`delete` λ…λ Ήμ–΄λ” λ„¤μ„μ¤νμ΄μ¤μ—μ„ λ…Έλ“ λ…μ„Έ λλ” μ‹ν¬λ¦Ώμ„ μ κ±°ν•©λ‹λ‹¤. μ‚¬μ© μμ‹λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

```sh
./dist/uniflowctl delete nodes --namespace default --filename examples/nodes.yaml
```

λλ”

```sh
./dist/uniflowctl delete secrets --namespace default --filename examples/secrets.yaml
```

μ΄ λ…λ Ήμ–΄λ” μ§€μ •λ νμΌμ— μ •μλ λ¨λ“  λ…Έλ“ λ…μ„Έ λλ” μ‹ν¬λ¦Ώμ„ μ κ±°ν•©λ‹λ‹¤. λ„¤μ„μ¤νμ΄μ¤λ¥Ό μ§€μ •ν•μ§€ μ•μΌλ©΄ `default` λ„¤μ„μ¤νμ΄μ¤κ°€ μ‚¬μ©λ©λ‹λ‹¤.

### Get

`get` λ…λ Ήμ–΄λ” λ„¤μ„μ¤νμ΄μ¤μ—μ„ λ…Έλ“ λ…μ„Έ λλ” μ‹ν¬λ¦Ώμ„ μ΅°νν•©λ‹λ‹¤. μ‚¬μ© μμ‹λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

```sh
./dist/uniflowctl get nodes --namespace default
```

λλ”

```sh
./dist/uniflowctl get secrets --namespace default
```

μ΄ λ…λ Ήμ–΄λ” μ§€μ •λ λ„¤μ„μ¤νμ΄μ¤μ λ¨λ“  λ…Έλ“ λ…μ„Έ λλ” μ‹ν¬λ¦Ώμ„ ν‘μ‹ν•©λ‹λ‹¤. λ„¤μ„μ¤νμ΄μ¤λ¥Ό μ§€μ •ν•μ§€ μ•μΌλ©΄ `default` λ„¤μ„μ¤νμ΄μ¤κ°€ μ‚¬μ©λ©λ‹λ‹¤.

## HTTP API ν†µν•©

HTTP APIλ¥Ό ν†µν•΄ λ…Έλ“ λ…μ„Έλ¥Ό μμ •ν•λ ¤λ©΄ ν•΄λ‹Ή κΈ°λ¥μ„ λ…Έμ¶ν•λ” μ›ν¬ν”λ΅μ°λ¥Ό μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ [κΈ°λ³Έ ν™•μ¥](../ext/README_kr.md)μ— ν¬ν•¨λ `native` λ…Έλ“λ¥Ό ν™μ©ν•  μ μμµλ‹λ‹¤:

```yaml
kind: native
opcode: nodes.create # λλ” nodes.read, nodes.update, nodes.delete
```

μ‹μ‘ν•λ ¤λ©΄ [μ›ν¬ν”λ΅μ° μμ ](../examples/system.yaml)λ¥Ό μ°Έκ³ ν•μ„Έμ”. ν•„μ”μ— λ”°λΌ μ΄ μ›ν¬ν”λ΅μ°μ— μΈμ¦ λ° κ¶ν• λ¶€μ—¬ ν”„λ΅μ„Έμ¤λ¥Ό μ¶”κ°€ν•  μ μμµλ‹λ‹¤. μΌλ°μ μΌλ΅ μ΄λ¬ν• λ°νƒ€μ„ μ μ–΄ μ›ν¬ν”λ΅μ°λ” `system` λ„¤μ„μ¤νμ΄μ¤μ— μ •μλ©λ‹λ‹¤.
